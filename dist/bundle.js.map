{"version":3,"file":"bundle.js","sources":["../src/utils.js","../src/lib/Limelight.js","../src/index.js"],"sourcesContent":["function mergeOptions(defaultOptions = {}, userOptions = {}) {\n  return Object.keys(defaultOptions)\n    .reduce((obj, key) => (\n      Object.assign(obj, {\n        [key]: userOptions[key]\n          ? userOptions[key]\n          : defaultOptions[key],\n      })\n    ), {});\n}\n\nexport default {\n  mergeOptions,\n};\n","// @ts-check\nimport u from '../utils';\n\nclass Limelight {\n  constructor(target, options = {}) {\n    this.id = 'clipElem';\n\n    this.topOffset = window.pageYOffset;\n\n    this.elems = {\n      // Handle querySelector or querySelectorAll\n      target: target.length > 1 ? Array.from(target) : [target],\n    };\n\n    this.options = u.mergeOptions(Limelight.defaultOptions, options);\n\n    this.isOpen = false;\n\n    this.events = {\n      open: new Event('open'),\n      close: new Event('close'),\n    };\n\n    this.close = this.close.bind(this);\n    this.reposition = this.reposition.bind(this);\n    this.repositionLoop = this.repositionLoop.bind(this);\n\n    this.init();\n  }\n\n  destroy() {\n    if (this.loop) cancelAnimationFrame(this.loop);\n    this.elems.limelight.parentNode.removeChild(this.elems.limelight);\n  }\n\n  createBGElem() {\n    const svgTemplate = this.renderSVG();\n    return document.createRange().createContextualFragment(svgTemplate);\n  }\n\n  /**\n   * Creates a string that represents gradient stop points.\n   * @return string\n   */\n  renderSVG() {\n    return `\n      <div class=\"limelight\" id=\"${this.id}\" aria-hidden>\n        <svg height=\"100%\" width=\"100%\">\n          <defs>\n            <mask id=\"${this.id}-mask\">\n              <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"white\" />\n              ${this.elems.target.map((elem, i) => `\n                <rect class=\"${this.id}-window\" id=\"${this.id}-window-${i}\" x=\"0\" y=\"0\" width=\"0\" height=\"0\" fill=\"black\" />\n              `).join('')}\n            </mask>\n          </defs>\n          <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"black\" opacity=\"0.8\" style=\"mask: url('#${this.id}-mask'); pointer-events: none;\" />\n        </svg> \n      </div>\n    `;\n  }\n\n  reposition() {\n    this.elems.maskWindows.forEach((mask, i) => {\n      const pos = this.elems.target[i].getBoundingClientRect();\n      mask.setAttribute('x', pos.x - this.options.offset);\n      mask.setAttribute('y', pos.y - this.options.offset);\n      mask.setAttribute('width', pos.width + (this.options.offset * 2));\n      mask.setAttribute('height', pos.height + (this.options.offset * 2));\n    });\n  }\n\n  repositionLoop() {\n    if (this.topOffset !== window.pageYOffset) {\n      this.reposition();\n    }\n\n    this.topOffset = window.pageYOffset;\n\n    this.loop = requestAnimationFrame(this.repositionLoop);\n  }\n\n  init() {\n    const svgElem = this.createBGElem();\n    this.elems.limelight = svgElem.querySelector(`#${this.id}`);\n    this.elems.maskWindows = Array.from(svgElem.querySelectorAll(`.${this.id}-window`));\n\n    document.body.appendChild(svgElem);\n\n    this.reposition();\n    // this.bindListeners();\n  }\n\n  open(e) {\n    if (this.isOpen) return;\n\n    this.isOpen = true;\n\n    // If it looks like an event, try to stop it bubbling.\n    if (e && e.target) {\n      e.stopPropagation();\n    }\n\n    this.elems.limelight.classList.add(this.options.classes.activeClass);\n\n    this.broadcastEvent(this.events.open);\n\n    // If we don't encourage the listener to happen on next-tick,\n    // we'll end up with the listener firing for this if it was triggered on-click.\n    // This is safeguard for when the event is not passed in and thus propgation\n    // can't be stopped.\n    requestAnimationFrame(() => {\n      if (this.options.closeOnClick) {\n        document.addEventListener('click', this.close);\n      }\n\n      this.loop = this.repositionLoop();\n    });\n  }\n\n  close() {\n    if (!this.isOpen) return;\n\n    this.isOpen = false;\n\n    this.elems.limelight.classList.remove(this.options.classes.activeClass);\n\n    this.broadcastEvent(this.events.close);\n\n    document.removeEventListener('click', this.close);\n\n    cancelAnimationFrame(this.loop);\n  }\n\n  broadcastEvent(event) {\n    [...this.elems.target, this.elems.limelight]\n      .forEach(elem => elem.dispatchEvent(event));\n  }\n\n  on(event, callback) {\n    this.elems.limelight.addEventListener(event, callback);\n  }\n\n  // bindListeners() {\n    // this.loop = requestAnimationFrame(this.repositionLoop);\n  // }\n}\n\nLimelight.defaultOptions = {\n  offset: 10,\n  closeOnClick: true,\n  classes: {\n    activeClass: 'limelight--is-active',\n  },\n};\n\nexport default Limelight;\n","import Limelight from './lib/Limelight';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const targets = document.querySelectorAll('.box__thing');\n  const boxGrad = new Limelight(targets);\n\n  document.querySelector('.js-start').addEventListener('click', (e) => {\n    e.stopPropagation();\n    e.preventDefault();\n    boxGrad.open();\n  });\n\n  boxGrad.on('open', () => {\n    console.log('opening');\n  });\n\n  boxGrad.on('close', () => {\n    console.log('closing');\n  });\n\n  // targets.forEach(target => {\n  //   target.addEventListener('open', () => {\n  //     console.log('we are opening');\n  //   });\n  //   target.addEventListener('close', () => {\n  //     console.log('we are closing');\n  //   });\n  // })\n\n  console.log(boxGrad);\n});\n"],"names":[],"mappings":"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"}